<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML><HEAD>
 <TITLE>HistView Api Doc</TITLE>
 <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</HEAD><BODY BGCOLOR="white">
<table BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<tr>
<td COLSPAN=2 BGCOLOR="#EEEEFF">
<em><b>HistView Api Doc</b></em></td>
</tr>
<tr><td VALIGN="top"><font SIZE="-2">SUMMARY: &nbsp;FIELD&nbsp;|&nbsp;<A HREF="#_section_constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#_section_method_summary">METHOD</A></font></td>
<td VALIGN="top"><font SIZE="-2">DETAIL: &nbsp;FIELD&nbsp;|&nbsp;<A HREF="#_section_constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#_section_method_detail">METHOD</A></font></td>
</tr>
</table>
<HR>
<H2><FONT SIZE="-1">Api</FONT><BR>
Class download</H2>

<HR>
<DL>
<DT>class <B>download</B><P>Scanning a directory and checking for download files</P>
<DL><DT><B>Authors:</B></DT><DD>Izzy (devel@izzysoft.de)</DD></DL>
<DL><DT><B>Version:</B></DT><DD>$Revision$ $Date$</DD></DL>
<DL><DT><B>Copyright:</B></DT><DD>(c) 2007 by Itzchak Rehberg and IzzySoft</DD></DL>
</DL>
<HR>
<P><A NAME="_section_constructor_summary"></A><TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF">
<TD COLSPAN=2><FONT SIZE="+2"><B>Constructor Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#download()">download</A></b>([string $basedir], [string $icondir])</CODE><BR>
Initial setup of default filetypes and date format</TD></TR>
</TABLE></P>
<P><A NAME="_section_method_summary"></A><TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF">
<TD COLSPAN=2><FONT SIZE="+2"><B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#add_details()">add_details</A></b>([string $descdir], [boolean $descreplace])</CODE><BR>
Add details to the filelist (fields "size" and "date")</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>private void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#ar_sort_by()">ar_sort_by</A></b>(array $arr, string $orderby, [boolean $rev], [integer $method])</CODE><BR>
Sort array by given key</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#db_setup()">db_setup</A></b>(string $host, string $database, string $user, string $passwd, string $table)</CODE><BR>
Setup database connection</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#dbcounter()">dbcounter</A></b>(string $filename)</CODE><BR>
Increase download counter in the database</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>array </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#get_filelist()">get_filelist</A></b>()</CODE><BR>
Get full (interpreted) filelist</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>array </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#get_filenames()">get_filenames</A></b>()</CODE><BR>
Get the list of files</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>private void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#interprete_filelist()">interprete_filelist</A></b>([integer $dirnum])</CODE><BR>
Generate list of all files incl.</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#scan_dir()">scan_dir</A></b>(string $dir, [integer $dirnum])</CODE><BR>
Scan another directory
  Switches to another directory.</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>boolean </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#send_latest()">send_latest</A></b>(string $prog, string $type, [string $directory])</CODE><BR>
Send latest version</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>boolean </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#sendfile()">sendfile</A></b>(string $filename, [string $directory])</CODE><BR>
Download a file</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_argsep()">set_argsep</A></b>(string $separator)</CODE><BR>
Set the argument separator
  This is how to separate arguments in the URL.</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_dateformat()">set_dateformat</A></b>(string $format)</CODE><BR>
Set the date format to use</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_dllinktype()">set_dllinktype</A></b>(string $type)</CODE><BR>
Set download linktype</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_excludes()">set_excludes</A></b>(array $excludes, [boolean $replace])</CODE><BR>
Setup exclude list</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_filetype()">set_filetype</A></b>(string $type, string $mask, string $extension, [string $icon])</CODE><BR>
Setup file types</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#set_icondir()">set_icondir</A></b>(string $dir)</CODE><BR>
Set the directory (URL) where your icons reside</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#sort_by_filename()">sort_by_filename</A></b>([boolean $rev])</CODE><BR>
Sort by filename</TD></TR>
<TR BGCOLOR="white"><TD WIDTH="1%" VALIGN="top"><FONT SIZE="-1"><CODE>void </CODE></FONT></TD><TD ALIGN="left" VALIGN="top"><CODE><b><A HREF="#sort_by_version()">sort_by_version</A></b>([boolean $rev])</CODE><BR>
Sort filelist by version</TD></TR>
</TABLE></P>
<A NAME="_section_constructor_detail"></A><P><TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF"><TD COLSPAN=1><FONT SIZE="+2"><B>Constructor Detail</B></FONT></TD>
</TR></TABLE><BR>
<A NAME="download()"></A><H3>download()</H3>
<PRE>
void <b>download</b>([string $basedir], [string $icondir])</PRE>
<DL><DD><P>Initial setup of default filetypes and date format</P>
<DL><DT><B>Parameters:</B></DT><DD><code>basedir</code> - What  to cut off to generate a download link.
        This is usually your web servers document root. This parameter is
        not needed when using the internal download method (default).<BR>
<code>icondir</code> - URL  of the directory where the icons reside</DD></DL>
</DD></DL><HR>
<A NAME="_section_method_detail"></A><P><TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF"><TD COLSPAN=1><FONT SIZE="+2"><B>Method Detail</B></FONT></TD>
</TR></TABLE><BR>
<A NAME="add_details()"></A><H3>add_details()</H3>
<PRE>
void <b>add_details</b>([string $descdir], [boolean $descreplace])</PRE>
<DL><DD><P>Add details to the filelist (fields "size" and "date")</P>
<DL><DT><B>Parameters:</B></DT><DD><code>descdir</code> - Directory  where the description files reside.
        Name of a description file must be either &lt;name&gt;.desc (for a
        general, version independent description) or
        &lt;name&gt;_&lt;version&gt;.desc (description bound to a specific
        version). The latter one is used (if found), the first one otherwise
        (if found). Descriptions will be preceded by "&lt;name&gt; v&lt;version&gt;".
        If a description file is found, it then will be added after an additional
        line break (&lt;BR&gt;).<BR>
<code>descreplace</code> - Replace  the short desc (TRUE, default)
        or append to it (FALSE)</DD></DL>
</DD></DL><HR>
<A NAME="ar_sort_by()"></A><H3>ar_sort_by()</H3>
<PRE>
private void <b>ar_sort_by</b>(array $arr, string $orderby, [boolean $rev], [integer $method])</PRE>
<DL><DD><P>Sort array by given key</P>
<DL><DT><B>Parameters:</B></DT><DD><code>arr</code> - Array  to sort<BR>
<code>orderby</code> - Field  to order by<BR>
<code>rev</code> - Reverse  order (default:false)<BR>
<code>method</code> - One  of the constants SORT_REGULAR,
        SORT_NUMERIC, SORT_STRING, SORT_LOCALE_STRING</DD></DL>
</DD></DL><HR>
<A NAME="db_setup()"></A><H3>db_setup()</H3>
<PRE>
void <b>db_setup</b>(string $host, string $database, string $user, string $passwd, string $table)</PRE>
<DL><DD><P>Setup database connection</P>
<DL><DT><B>Parameters:</B></DT><DD><code>host</code> - hostname  the DB is running on<BR>
<code>database</code> - Name  of the database to use<BR>
<code>user</code> - DB  User to connect with<BR>
<code>passwd</code> - Password  to use<BR>
<code>table</code> - Name  of the download table</DD></DL>
</DD></DL><HR>
<A NAME="dbcounter()"></A><H3>dbcounter()</H3>
<PRE>
void <b>dbcounter</b>(string $filename)</PRE>
<DL><DD><P>Increase download counter in the database</P>
<DL><DT><B>Parameters:</B></DT><DD><code>filename</code> - Filename  to process</DD></DL>
</DD></DL><HR>
<A NAME="get_filelist()"></A><H3>get_filelist()</H3>
<PRE>
array <b>get_filelist</b>()</PRE>
<DL><DD><P>Get full (interpreted) filelist</P>
<DL><DT><B>Returns:</B></DT><DD>Array[0..n]  of file arrays.
         File array has the properties dir,name,version,sortver,file, icon, ilink (link with icon) and flink (link with filename).
         If add_details was run before, size, date and desc are also available.</DD></DL>
</DD></DL><HR>
<A NAME="get_filenames()"></A><H3>get_filenames()</H3>
<PRE>
array <b>get_filenames</b>()</PRE>
<DL><DD><P>Get the list of files</P>
<DL><DT><B>Returns:</B></DT><DD>Array[0..n]  of filenames</DD></DL>
</DD></DL><HR>
<A NAME="interprete_filelist()"></A><H3>interprete_filelist()</H3>
<PRE>
private void <b>interprete_filelist</b>([integer $dirnum])</PRE>
<DL><DD><P>Generate list of all files incl. basic information
  Is called from method scan_dir</P>
<DL><DT><B>Parameters:</B></DT><DD><code>dirnum</code> - If  you run multiple directories via an array, you can store the index here. Will be added to the DL URL, when internal DL method is used.</DD></DL>
</DD></DL><HR>
<A NAME="scan_dir()"></A><H3>scan_dir()</H3>
<PRE>
void <b>scan_dir</b>(string $dir, [integer $dirnum])</PRE>
<DL><DD><P>Scan another directory
  Switches to another directory. This resets the internal file array and starts over.
  The filelist array will not be reset, so entries are added to it.</P>
<DL><DT><B>Parameters:</B></DT><DD><code>dir</code> - Directory  to scan<BR>
<code>dirnum</code> - If  you run multiple directories via an array, you can store the index here. Will be added to the DL URL, when internal DL method is used.</DD></DL>
</DD></DL><HR>
<A NAME="send_latest()"></A><H3>send_latest()</H3>
<PRE>
boolean <b>send_latest</b>(string $prog, string $type, [string $directory])</PRE>
<DL><DD><P>Send latest version</P>
<DL><DT><B>Parameters:</B></DT><DD><code>prog</code> - Which  program is requested<BR>
<code>type</code> - What  type of archive (first parameter of set_filetype)<BR>
<code>directory</code> - Directory  where the file resides (if it was not scanned yet)</DD></DL>
<DL><DT><B>Returns:</B></DT><DD>file_send  Whether we found something to send.</DD></DL>
</DD></DL><HR>
<A NAME="sendfile()"></A><H3>sendfile()</H3>
<PRE>
boolean <b>sendfile</b>(string $filename, [string $directory])</PRE>
<DL><DD><P>Download a file</P>
<DL><DT><B>Parameters:</B></DT><DD><code>filename</code> - File  to download<BR>
<code>directory</code> - Directory  where the file resides (if other than the recent one)</DD></DL>
<DL><DT><B>Returns:</B></DT><DD>file_sent  TRUE if file found, FALSE otherwise</DD></DL>
</DD></DL><HR>
<A NAME="set_argsep()"></A><H3>set_argsep()</H3>
<PRE>
void <b>set_argsep</b>(string $separator)</PRE>
<DL><DD><P>Set the argument separator
  This is how to separate arguments in the URL. Default is ";" - you may
  want to set this to "&"</P>
<DL><DT><B>Parameters:</B></DT><DD><code>separator</code> - </DD></DL>
</DD></DL><HR>
<A NAME="set_dateformat()"></A><H3>set_dateformat()</H3>
<PRE>
void <b>set_dateformat</b>(string $format)</PRE>
<DL><DD><P>Set the date format to use</P>
<DL><DT><B>Parameters:</B></DT><DD><code>format</code> - Date  format to use (refer to the PHP manual of date)</DD></DL>
</DD></DL><HR>
<A NAME="set_dllinktype()"></A><H3>set_dllinktype()</H3>
<PRE>
void <b>set_dllinktype</b>(string $type)</PRE>
<DL><DD><P>Set download linktype</P>
<DL><DT><B>Parameters:</B></DT><DD><code>type</code> - type  of the link</DD></DL>
</DD></DL><HR>
<A NAME="set_excludes()"></A><H3>set_excludes()</H3>
<PRE>
void <b>set_excludes</b>(array $excludes, [boolean $replace])</PRE>
<DL><DD><P>Setup exclude list</P>
<DL><DT><B>Parameters:</B></DT><DD><code>excludes</code> - Array  of files to exclude from listings<BR>
<code>replace</code> - Replace  the preset list (TRUE) or append to it (FALSE)? Default is to append.</DD></DL>
</DD></DL><HR>
<A NAME="set_filetype()"></A><H3>set_filetype()</H3>
<PRE>
void <b>set_filetype</b>(string $type, string $mask, string $extension, [string $icon])</PRE>
<DL><DD><P>Setup file types</P>
<DL><DT><B>Parameters:</B></DT><DD><code>type</code> - Short  name for the type, e.g. "rpm", "deb", "tar"<BR>
<code>mask</code> - Corresponding  regexp mask. The back references should be
        set such that <ul><li>\1 is the name of the software</li>
        <li>\2.\3.\4 make up the version</li>
        <li>optional \5 sets the release number (required for *.deb and *.rpm)</li></ul><BR>
<code>extension</code> - File  extension to identify this type - e.g. "deb" or "tar.gz"<BR>
<code>icon</code> - Complete  img tag to display for this type</DD></DL>
</DD></DL><HR>
<A NAME="set_icondir()"></A><H3>set_icondir()</H3>
<PRE>
void <b>set_icondir</b>(string $dir)</PRE>
<DL><DD><P>Set the directory (URL) where your icons reside</P>
<DL><DT><B>Parameters:</B></DT><DD><code>dir</code> - URL  of the directory where the icons reside</DD></DL>
</DD></DL><HR>
<A NAME="sort_by_filename()"></A><H3>sort_by_filename()</H3>
<PRE>
void <b>sort_by_filename</b>([boolean $rev])</PRE>
<DL><DD><P>Sort by filename</P>
<DL><DT><B>Parameters:</B></DT><DD><code>rev</code> - Reverse  order? Default: False</DD></DL>
</DD></DL><HR>
<A NAME="sort_by_version()"></A><H3>sort_by_version()</H3>
<PRE>
void <b>sort_by_version</b>([boolean $rev])</PRE>
<DL><DD><P>Sort filelist by version</P>
<DL><DT><B>Parameters:</B></DT><DD><code>rev</code> - Reverse  order? Default: False</DD></DL>
</DD></DL><HR>
<table BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<tr>
<td COLSPAN="2" BGCOLOR="#EEEEFF"><em><b>HistView Api Doc</b></em></td>
</tr>
<tr><td VALIGN="top"><font SIZE="-2">SUMMARY: &nbsp;FIELD&nbsp;|&nbsp;<A HREF="#_section_constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#_section_method_summary">METHOD</A></font></td>
<td VALIGN="top"><font SIZE="-2">DETAIL: &nbsp;FIELD&nbsp;|&nbsp;<A HREF="#_section_constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#_section_method_detail">METHOD</A></font></td>
</tr>
</table>
<HR>
<P><FONT SIZE="-1">This document was generated by <A HREF="http://www.arakhne.org/tools/phpdocgen/" target="_top">phpdocgen 0.16</A>.<BR>
Copyright &copy; 2002-03 <A HREF="mailto:galland@arakhne.prg">Stéphane GALLAND</A> (under the <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">GNU General Public License</A>)</FONT>
</P>

</BODY>
</HTML>